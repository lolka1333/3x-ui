# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º Shadowsocks 2022 –≤ X-UI - –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢

## üéØ –†–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞

**–ò—Å—Ö–æ–¥–Ω–∞—è –æ—à–∏–±–∫–∞:**
```
Failed to start: main: failed to load config files: [bin/config.json] > infra/conf: failed to build inbound config with tag inbound-XXXX > infra/conf: failed to build inbound handler for protocol shadowsocks > infra/conf: shadowsocks 2022 (multi-user): users must have empty method
```

## ‚úÖ –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. Frontend (JavaScript) - `web/assets/js/model/inbound.js`

**–ò–∑–º–µ–Ω—ë–Ω –º–µ—Ç–æ–¥ `toJson()` –∫–ª–∞—Å—Å–∞ `Inbound.ShadowsocksSettings.Shadowsocks` (—Å—Ç—Ä–æ–∫–∞ ~2235):**

```javascript
toJson() {
    // –î–ª—è Shadowsocks 2022 –≤ multi-user —Ä–µ–∂–∏–º–µ method –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç—ã–º
    const method = this.isSS2022(this.method) ? '' : this.method;
    
    return {
        method: method,  // –¢–µ–ø–µ—Ä—å –ø—É—Å—Ç–æ–µ –¥–ª—è SS2022
        password: this.password,
        email: this.email,
        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
    };
}
```

### 2. Backend (Go) - `web/service/inbound.go`

**–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Shadowsocks 2022:**
```go
func isSS2022(method string) bool {
    ss2022Methods := []string{
        "2022-blake3-aes-128-gcm",
        "2022-blake3-aes-256-gcm",
        "2022-blake3-chacha20-poly1305",
    }
    
    for _, ss2022Method := range ss2022Methods {
        if method == ss2022Method {
            return true
        }
    }
    return false
}
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 3 –º–µ—Ç–æ–¥–∞ API –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:**

1. **`AddInboundClient` (—Å—Ç—Ä–æ–∫–∞ ~509)**
2. **`UpdateInboundClient` (—Å—Ç—Ä–æ–∫–∞ ~753)**  
3. **`ResetClientTraffic` (—Å—Ç—Ä–æ–∫–∞ ~1612)**

```go
cipher := ""
if oldInbound.Protocol == "shadowsocks" {
    method := oldSettings["method"].(string)
    // –î–ª—è Shadowsocks 2022 cipher –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç—ã–º
    if !isSS2022(method) {
        cipher = method
    }
}
```

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

1. **–í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ Shadowsocks 2022 inbound, –∫–ª–∏–µ–Ω—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å –ø—É—Å—Ç—ã–º –ø–æ–ª–µ–º `method`

2. **–í API –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏:** –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Xray API, –¥–ª—è Shadowsocks 2022 –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π `cipher`

3. **–í Xray Core:** –ü–æ–ª—É—á–∏–≤ –ø—É—Å—Ç–æ–π cipher, Xray –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `shadowsocks_2022.ServerConfig` –≤–º–µ—Å—Ç–æ `shadowsocks.Account`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl stop x-ui

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl start x-ui

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status x-ui

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
sudo journalctl -u x-ui --no-pager | grep -E "(error|Error|failed|Failed)"

# 5. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Shadowsocks inbound —Å –º–µ—Ç–æ–¥–æ–º 2022-blake3-aes-256-gcm
# 6. –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤
# 7. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Xray –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
```

## üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

- ‚úÖ **–û—Å–Ω–æ–≤–Ω–∞—è –æ—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ Xray** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ SS2022 —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ method
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –æ–±—ã—á–Ω—ã–µ Shadowsocks –º–µ—Ç–æ–¥—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ  
- ‚úÖ **API –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ** - –≤—Å–µ –º–µ—Ç–æ–¥—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è SS2022
- ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤** - —Ä–µ—à–µ–Ω–∞ –ø—É—Ç–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- Shadowsocks 2022 inbound –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ SS2022 —Å–µ—Ä–≤–µ—Ä–∞–º  
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç SS2022 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ–±—ã—á–Ω—ã–º–∏ SS –º–µ—Ç–æ–¥–∞–º–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

**Shadowsocks 2022 –º–µ—Ç–æ–¥—ã:**
- `2022-blake3-aes-128-gcm`
- `2022-blake3-aes-256-gcm` 
- `2022-blake3-chacha20-poly1305`

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `web/assets/js/model/inbound.js` (1 –∏–∑–º–µ–Ω–µ–Ω–∏–µ)
- `web/service/inbound.go` (4 –∏–∑–º–µ–Ω–µ–Ω–∏—è: 1 —Ñ—É–Ω–∫—Ü–∏—è + 3 –º–µ—Ç–æ–¥–∞)

**–§–∞–π–ª—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã (–∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è):**
- `xray/api.go` - —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—É—Å—Ç–æ–π cipher –¥–ª—è SS2022